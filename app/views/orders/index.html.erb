<% if current_user.try(:admin?) %>

<h1>Listing orders</h1>

<table>
  <thead>
    <tr>
      <th>User</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @orders.each do |order| %>
      <tr>
        <td><%= order.user_id %></td>
        <td><%= link_to 'Show', order %></td>
        <td><%= link_to 'Edit', edit_order_path(order) %></td>
        <td><%= link_to 'Destroy', order, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Order', new_order_path %>

<% elsif user_signed_in? %>

<h1>Order</h1>

<table class="table">
  <thead>
    <tr>
      <th colspan="2">Item</th>
	  <th ></th>
    </tr>
  </thead>

	<tbody> <%# Actually, I will be displaying the cart items on the orders path. Confusing, I know. I can easily implement a "Past Orders" method, that will look like how the index typically looks, except I'll exclude any current, open orders from being displayed. No delete, edit, or anything like that as options. Can create a 'new' order from one of these old ones. It allows for reordering. But that's not even on this page. %>
		<%# @orders = @orders.select{ |t| t.user_id == current_user.id && } %>
		
		<% @cart_items = CartItem.all.select{ |t| t.user_id == current_user.id && t.order_id == current_user.open_order }%>
	    <% @cart_items.each do |item| %>
	      <tr>
	        <td><b><span class="text-primary"><%= Item.find(item.item_id).name %></span></b></td> <%# display modifiers? How to resolve ambiguity between items? Multiple rows, I suppose. That really seems to be the only way. It is going to be a rather complex layout. Each row (item row vs modifier row) needs to have different styles. Get rid of the hover. Get rid of the stripes. Option to remove modifiers from this page? [but no add, that'd be ridiculous!] %>
	        <td><%= link_to 'Edit', edit_cart_item_path(item), class: "btn btn-warning btn-xs btn-block" %></td> <%# do these options as a button group, float right %>
	        <td><%= link_to 'Remove from cart', item, method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-danger btn-xs btn-block" %></td>
	      </tr>
		 
		
		<%# begin %>

			<% selected_mods = SelectedModifier.all.select{ |t| t.cart_item_id == item.id }%>

					<% count = selected_mods.count %>	
					<% selected_mods.each_with_index do |sel, i| %>
						<% mod = Modifier.find(sel.modifier_id) %>

					<tr class="modifier_row" >
						<td><em><span class="text-muted"><%= mod.name %></em></span></td>
					</tr>
					<% end %>

		<%# end %>
			
	    <% end %>
	  </tbody>
	</table>

<% unless @cart_items.empty? %>

<%= link_to 'This order is for pick-up', pages_payment_path %>
<%= link_to 'This order is for delivery', pages_select_path %>

<% else %>
<p>Looks like your cart is empty. Look at our <%= link_to 'menu', pages_menu_path %> to see what you can add.</p>

<% end %>

<% end %>